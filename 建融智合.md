# 建融智合

## 一、地址

从沙盒里双击开启Chrome，输入gitlab地址

gitlab地址为：128.64.96.200

需要让磊哥为你添加项目权限

## 二、运行项目

1、下载node.js

2、cmd里输入node -v，npm -v确认是否下载成功

3、使用Git clone essp_vue到F盘。

该项目有submodule，还需要拉取子模块代码：

```shell
git submodule init

git submodule update
```

或者合二为一也可以：

```shell
git submodule update --init --recursive
```

子模块命令可查看：https://blog.csdn.net/toopoo/article/details/104225592

4、更改为建行镜像源：

```shell
npm config set registry http://128.196.0.125:9000/repository/npm_Public_group_bk/
```

> 我们常常用的是直接两步合一：设置+安装：npm install -g cnpm --registry=http://registry.npm.taobao.org 
>
> 还原为原来自带的：npm config set registry https://registry.npmjs.org/
>
> 各种命令的区别：https://www.cnblogs.com/onew/p/11330439.html

5、（可选）安装Webpack：npm install webpack -g

6、（可选）安装vue-cli：cnpm install vue-cli -g

7、进入项目所在文件夹：npm install

配置为建行的npm之后还是无法正确下载包，问题如下：

> code ENOVERSIONS
>
> No valid versions available for undefined

① 方法一（推荐）

> npm cache clean --force（清理缓存）
>
> rm -rf node_modules （或者自己手动删除）
>
> rm -rf package-lock.json （或者自己手动删除）
>
> npm install
>
> npm install 安装的是package.json里的版本，但是去哪里获取是在package-lock.json里的，所以lock这个文件必删！

② 方法二：改用SFTP方式交换node_module文件，具体是使用公司提供的SFTP中转站。下载 [FileZilla](http://128.64.171.56/client/09_%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3/) 来进行SFTP中转。

> SFTP到服务器:128.64.96.168(端口22），用户密码：xmftp/xmftp，目录KOUHANG。每天会清理。

8、运行：npm run dev

报错消息如下：

> <---  JS stacktrace --->
>
> ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory
>
> 1: ...
>
> npm ERR! CODE ELIFECYCLE
>
> npm ERR! errno 134
>
> npm ERR! esspweb@1.0.0 start: 'node --max_old_space_size=2048' node_modules/webpack-dev-server/bin/webpack-dev-server.js --inline --progress --config build/webpack.dev.conf.js --open'
>
> npm ERR! Failed at the esspweb@1.0.0 start script.
>
> npm ERR! esspweb@1.0.0 dev: 'node config/reconfig.js development && npm run start'
>
> npm ERR! Failed at the esspweb@1.0.0 dev script.

解决方法为：进入package.json文件里修改scripts下的start：

```javascript
start: 'node --max_old_space_size=2048' node_modules/webpack-dev-server/bin/webpack-dev-server.js --inline --progress --config build/webpack.dev.conf.js --open'
```

将2048改为4096即可。

可以顺带把build标签的2048也改为4096。

## 三、项目结构

| 目录         | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| build        | 项目构建Webpack相关代码。                                    |
| config       | 配置目录（例如端口号-serverlp.js，开发、生产、测试的环境变量） |
| node_modules | npm install 后下载的依赖模块放在此文件夹                     |
| src          | App.vue：项目入口文件。main.js：项目核心文件。新建的vue项目它会初始化 Vue 应用并且制定将应用挂载到  index.html 文件中的哪个 HTML 元素上。通常还会做一些注册全局组件或者添额外的 Vue 库的操作。 |
| static       | 静态资源，如图片、字体等                                     |
| test         | 初始测试目录，可删除                                         |
| index.html   | 首页入口文件，可以添加meta信息、title                        |
| package.json | 项目配置文件，类似Android中的build.gradle                    |

## 权限相关

* 外网登的是是生产环境，要登录测试环境：want1.ccb.com / want2.ccb.com，登录账号可以查看禅道的Bug用例贴上来的用例。

  这里也有几个账号可参考：

  | 区域     | 账号        | 密码       |
  | -------- | ----------- | ---------- |
  | 132      | 13585584020 | Ccb111111  |
  | 131      | 18860205020 | Aa123123   |
  | 131      | 15805931113 | Ccb111111  |
  | 131      | 13350092030 | Aa123123   |
  | 131      | 13350092031 | Aa123123   |
  | 131      | 15860205415 | Aa123123   |
  | 131      | 15159277134 | Qwer1234   |
  | （后台） | admin       | Esscjrzh12 |

* 禅道——类似Bugfree，地址为：128.64.98.105:8089 → 选择开源版。需要申请账号。

## 自动开发浏览器与热更新

config/index.js，修改autoOpenBrowser为true

config/index.js，修改dev中poll为true

build/webpack.dev.conf.js，修改devServer中的hot值为true

## 项目内容

要添加一个“权限”的Tab，点击跳转后会需要页面鉴权。

鉴权逻辑是由 main.js 里的router.beforeEach来执行的。

然后调用 page-filter.js 中的 router-filter 方法；其他页面进入的是 enterAuthPageEvent() （无需登录），而因为我的 pagePermission 没有包括在校验数组里，所以走的是 enterNonAuthPageEvent()，需要登录才能操作。

需要到 constants.js→auth-page-config.js 里将 pagePermission 的 name 加到 authUrl 数组里。

到此，点击不需要就不需要权限了。

> 因为Web调试的便捷性，一定要活用 console.log() 来打出log查看代码执行情况，很快就能理清逻辑结构。

### 提高vue项目编译速度

参考网上提高编译速度的设置会导致编译不成功啊！头疼。

问了磊哥后目前可以提高速度的方法是：在router的index.js里将用不到的给注释掉，这样可以提高编译速度。